<!DOCTYPE html>
<html>
<head>
  <title>공급자 목록</title>
</head>
<body>
  <h1>공급 가능한 서버 목록</h1>

  <!-- 로그인 상태에 따라 분기 -->
  <div style="margin-bottom: 20px;">
    {% if session.get('user_id') %}
      <p>환영합니다, {{ session.get('username') }}님!</p>
      <form action="{{ url_for('logout') }}" method="post" style="display:inline;">
        <button type="submit">로그아웃</button>
      </form>
    {% else %}
      <a href="{{ url_for('login') }}">로그인</a> |
      <a href="{{ url_for('html_register') }}">회원가입</a>
    {% endif %}
  </div>

  <!-- 공급자 리스트 -->
  <div>
    {% for p in providers %}
      <div style="border:1px solid #ccc; padding:10px; margin:10px;">
        <h2>{{ p.name }}</h2>
        <p>CPU 여유율: {{ p.cpu_free }}%</p>
        <p>RAM 여유량: {{ p.ram_free }} GiB</p>
        <p>상태: {{ p.status }}</p>
        <p>IP: {{ p.ip_address }}</p>

        <!-- 상세보기 버튼 -->
        <form action="{{ url_for('provider_detail', provider_id=p.id) }}" method="get" style="display:inline;">
          <button type="submit">상세보기</button>
        </form>

        <!-- 작업 요청 폼 -->
        {% if session.get('user_id') %}
          <form action="{{ url_for('submit_job', provider_id=p.id) }}" method="post" style="margin-top:10px;">
            <label>컨테이너 이미지:</label>
            <input type="text" name="image" value="alpine:3.19" style="width:200px;"><br><br>

            <label>실행 스크립트:</label><br>
            <textarea name="script" rows="2" cols="40" placeholder="예: echo start; sleep 2; echo done"></textarea><br><br>

            <label>환경 변수 (KEY=VALUE 줄바꿈 구분):</label><br>
            <textarea name="env" rows="2" cols="40" placeholder="FOO=BAR&#10;HELLO=WORLD"></textarea><br><br>

            <button type="submit">이 공급자에게 작업 요청</button>
          </form>
        {% else %}
          <p style="color:gray;">로그인 후 작업을 요청할 수 있습니다.</p>
        {% endif %}
      </div>
    {% endfor %}
  </div>
</body>
</html>
